## 快速失败(fail-fast)和安全失败(fail-safe)

**何为快速失败？**

快速失败是一种机制，他的特性就是在遍历java集合时候，不允许进行值的修改，否则会抛出ConcurrentModificationException 异常，那么实现原理是什么呢？以HashMap举例，在HashMap内部维护了一个变量，midCount，这个值在每次进行增删的时候会进行自增，当遍历集合的时候，每次通过next获取到值之前，都会判断这个值和可是遍历之前的值是否相同，如果不相同则证明在遍历期间被修改过，则停止遍历，抛出异常，如果没有被更改过，则返回被遍历的值。

**何为安全是失败？**

安全失败也是一种机制，他的含义就是可以在遍历期间对值进行修改，但是，修改的是该集合值的副本，在遍历期间原集合是不知道被修改了，所以还是保持原值，只有在遍历结束之后才将修改后的值赋回给原集合。副本是在遍历开始之前复制出来的一份，与原集合无关。

**应用场景**

在java中，java.util下的所有容器都是快速失败的，例如HashMap、HashTable。而在java.util.current下，所有的容器都是安全失败的，例如ConCurrentHashMap

**优缺点**

HashMap、HashTable是不允许在遍历期间被修改的，修改会抛出异常ConcurrentModificationException ，而是可以在并发比遍历环境下修改的，但是像ConCurrentHashMap可以在遍历期间多线程并发修改。

但是，采用安全失败机制会比较占用内存，因为要存储副本。

> 此处指的遍历是采用Iterator遍历！！！